DROP TABLE SPJ CASCADE CONSTRAINTS;
DROP TABLE P CASCADE CONSTRAINTS;
DROP TABLE J CASCADE CONSTRAINTS;
DROP TABLE S CASCADE CONSTRAINTS;
CREATE TABLE P(
	cod_p VARCHAR2(2) NOT NULL,
	nombre_p VARCHAR2(20),
	color VARCHAR2(5),
	peso NUMBER(2),
	ciudad VARCHAR2(7),
	precio NUMBER(3),
	CONSTRAINT PK_P PRIMARY KEY(cod_p)
);
CREATE TABLE J(
	cod_j VARCHAR2(2) NOT NULL,
	nombre_j VARCHAR2(20),
	ciudad VARCHAR2(7),
	CONSTRAINT PK_J PRIMARY KEY(cod_j)
);
CREATE TABLE S(
	cod_s VARCHAR2(2) NOT NULL,
	nombre_s VARCHAR2(5),
	estado NUMBER(2),
	ciudad VARCHAR2(7),
CONSTRAINT PK_S PRIMARY KEY(cod_s)
);
CREATE TABLE SPJ(
	cod_s VARCHAR2(2) NOT NULL,
	cod_p VARCHAR2(2) NOT NULL,
	cod_j VARCHAR2(2) NOT NULL,
	cantidad NUMBER(3),
	CONSTRAINT PK_SPJ PRIMARY KEY(cod_s,cod_p,cod_j),
	CONSTRAINT FK_COD_S_S FOREIGN KEY (COD_S) REFERENCES S,
	CONSTRAINT FK_COD_J_J FOREIGN KEY (COD_J) REFERENCES J,
	CONSTRAINT FK_COD_P_P FOREIGN KEY (COD_P) REFERENCES P
);
INSERT INTO P VALUES ('p1','tuerca','rojo',12,'Londres',5);
INSERT INTO P VALUES ('p2','cerrojo','verde',17,'París',150);
INSERT INTO P VALUES ('p3','tornillo','azul',17,'Roma',7);
INSERT INTO P VALUES ('p4','tornillo','rojo',14,'Londres',10);
INSERT INTO P VALUES ('p5','leva','azul',12,'París',256);
INSERT INTO P VALUES ('p6','diente','rojo',19,'Londres',312);
INSERT INTO J VALUES ('j1','Clasifica','París');
INSERT INTO J VALUES ('j2','Perforad','Roma');
INSERT INTO J VALUES ('j3','Lector','Atenas');
INSERT INTO J VALUES ('j4','Consola','Atenas');
INSERT INTO J VALUES ('j5','Compar','Londres');
INSERT INTO J VALUES ('j6','Terminal','Oslo');
INSERT INTO J VALUES ('j7','Cinta','Londres');
INSERT INTO S VALUES ('s1','Smith',20,'Londres');
INSERT INTO S VALUES ('s2','Jones',10,'París');
INSERT INTO S VALUES ('s3','Blake',30,'París');
INSERT INTO S VALUES ('s4','Clark',20,'Londres');
INSERT INTO S VALUES ('s5','Adams',30,'Atenas');
INSERT INTO SPJ VALUES ('s1','p1','j1',200);
INSERT INTO SPJ VALUES ('s1','p1','j4',700);
INSERT INTO SPJ VALUES ('s2','p3','j1',400);
INSERT INTO SPJ VALUES ('s2','p3','j2',200);
INSERT INTO SPJ VALUES ('s2','p3','j3',200);
INSERT INTO SPJ VALUES ('s2','p3','j4',500);
INSERT INTO SPJ VALUES ('s2','p3','j5',600);
INSERT INTO SPJ VALUES ('s2','p3','j6',400);
INSERT INTO SPJ VALUES ('s2','p3','j7',800);
INSERT INTO SPJ VALUES ('s2','p5','j2',100);
INSERT INTO SPJ VALUES ('s3','p3','j1',200);
INSERT INTO SPJ VALUES ('s3','p4','j2',500);
INSERT INTO SPJ VALUES ('s4','p6','j3',300);
INSERT INTO SPJ VALUES ('s4','p6','j7',300);
INSERT INTO SPJ VALUES ('s5','p1','j4',100);
INSERT INTO SPJ VALUES ('s5','p2','j2',200);
INSERT INTO SPJ VALUES ('s5','p2','j4',100);
INSERT INTO SPJ VALUES ('s5','p3','j4',200);
INSERT INTO SPJ VALUES ('s5','p4','j4',800);
INSERT INTO SPJ VALUES ('s5','p5','j4',400);
INSERT INTO SPJ VALUES ('s5','p5','j5',500);
INSERT INTO SPJ VALUES ('s5','p5','j7',100);
INSERT INTO SPJ VALUES ('s5','p6','j2',200);
INSERT INTO SPJ VALUES ('s5','p6','j4',500);
--EJERCICIOS BOLETIN
--1
SELECT * FROM J;
--2
SELECT * FROM J
  WHERE ciudad='Londres';
--3
SELECT COD_S FROM S
 WHERE COD_S IN (SELECT COD_S FROM SPJ
                    WHERE COD_J='j1')
	ORDER BY COD_S;					
--4
SELECT * FROM SPJ
	WHERE CANTIDAD BETWEEN 300 AND 750;
--5
SELECT DISTINCT COLOR,CIUDAD,COUNT(*) FROM P
  GROUP BY COLOR,CIUDAD;
--6
SELECT COD_S,COD_P,COD_J FROM S,P,J
  WHERE J.CIUDAD=S.CIUDAD AND J.CIUDAD=P.CIUDAD
        AND S.CIUDAD=P.CIUDAD;
--7
SELECT SPJ.COD_S,SPJ.COD_P,SPJ.COD_J FROM SPJ,J,S,P
  WHERE SPJ.COD_S=S.COD_S AND SPJ.COD_P=P.COD_P
        AND J.COD_J=SPJ.COD_J AND J.CIUDAD=S.CIUDAD AND J.CIUDAD=P.CIUDAD
        AND S.CIUDAD=P.CIUDAD;
--8
SELECT COD_S,COD_P,COD_J FROM S,P,J
  WHERE NOT (J.CIUDAD=S.CIUDAD AND J.CIUDAD=P.CIUDAD
        AND S.CIUDAD=P.CIUDAD);
--9
SELECT S.COD_S,P.COD_P,J.COD_J FROM S,P,J
  WHERE S.CIUDAD!=P.CIUDAD AND S.CIUDAD!=J.CIUDAD
          AND J.CIUDAD!=P.CIUDAD;
--9B
SELECT SPJ.COD_S,SPJ.COD_P,SPJ.COD_J FROM SPJ,J,S,P
  WHERE SPJ.COD_S=S.COD_S AND SPJ.COD_P=P.COD_P
        AND J.COD_J=SPJ.COD_J AND NOT(J.CIUDAD=S.CIUDAD AND J.CIUDAD=P.CIUDAD
        AND S.CIUDAD=P.CIUDAD);
--10
SELECT COD_P FROM P
  WHERE COD_P IN(SELECT COD_P FROM SPJ
                    WHERE COD_S IN(SELECT COD_S FROM S
                                    WHERE CIUDAD='Londres'));
--11
SELECT COD_P FROM P
  WHERE COD_P IN(SELECT COD_P FROM SPJ
                    WHERE COD_S IN(SELECT COD_S FROM S
                                    WHERE CIUDAD='Londres')
							AND COD_J IN(SELECT COD_J FROM J
											WHERE CIUDAD='Londres'));
--12
SELECT J.CIUDAD,S.CIUDAD FROM S,J
  WHERE COD_S IN(SELECT COD_S FROM SPJ)AND 
        COD_J IN(SELECT COD_J FROM SPJ);
--13
SELECT COD_P FROM P
  WHERE COD_P IN(SELECT COD_P FROM SPJ,J,S
                  WHERE J.COD_J=SPJ.COD_J AND S.COD_S=SPJ.COD_S
                    AND J.CIUDAD=S.CIUDAD);
                    --SOL INTERNET
SELECT DISTINCT SPJ.cod_p FROM SPJ, S, J
WHERE SPJ.cod_s = S.cod_s AND SPJ.cod_j = J.cod_j AND S.ciudad = J.ciudad; 
--14
SELECT COD_J FROM J
  WHERE COD_J IN(SELECT COD_J FROM SPJ
                  WHERE COD_J IN(SELECT COD_J FROM P
                                  WHERE J.CIUDAD!=P.CIUDAD));
								  
								--SOL INTERNET
SELECT DISTINCT SPJ.COD_j FROM SPJ, S, J
WHERE SPJ.COD_s = S.COD_s AND SPJ.COD_j = J.COD_j AND S.ciudad <> J.ciudad;
--15
SELECT DISTINCT SPJ.COD_P,P.COD_P FROM SPJ,P
  WHERE SPJ.COD_P<P.COD_P;
--16
SELECT COUNT(*) FROM P
  WHERE COD_P IN(SELECT COD_P FROM SPJ
                    WHERE COD_S=(SELECT COD_S FROM S
                                    WHERE COD_S='s1'));
--17
SELECT COUNT(*) FROM P
  WHERE COD_P='p1' AND COD_P IN(SELECT COD_P FROM SPJ
                                  WHERE COD_S='s1');
--18
SELECT COD_P,COD_J,CANTIDAD FROM SPJ;
--19
SELECT COD_J,COD_p FROM SPJ
GROUP BY COD_J,COD_p HAVING AVG(CANTIDAD)>320;
--20
SELECT COD_S,COD_J,COD_P FROM SPJ
 WHERE NVL(CANTIDAD,0)!=0;
--21
SELECT COD_J FROM J
  WHERE SUBSTR(CIUDAD,2,1)='o';
--22
SELECT COD_J FROM J
  WHERE COD_J IN (SELECT COD_J FROM SPJ
                      WHERE COD_S='s1');
--23
SELECT COLOR FROM p
  WHERE COD_p IN (SELECT COD_p FROM SPJ
                      WHERE COD_S='s1');
--24
SELECT DISTINCT COD_P FROM SPJ
  WHERE COD_J IN(SELECT COD_J FROM J
                WHERE CIUDAD='Londres');
--25
SELECT COD_J FROM SPJ
  WHERE COD_S='s1';
--26
SELECT COD_S FROM S
	WHERE COD_S IN(SELECT COD_S FROM SPJ
					WHERE COD_S IN(SELECT COD_S FROM SPJ
									WHERE COD_P IN(SELECT COD_P FROM P
													WHERE COLOR='rojo')));
--27
SELECT COD_S FROM S
  WHERE ESTADO<(SELECT ESTADO FROM S
                   WHERE COD_S='s1'); 
--28
SELECT COD_J FROM SPJ
  WHERE COD_P='p1' AND CANTIDAD>(SELECT AVG(CANTIDAD) FROM SPJ
                                  WHERE COD_J='j1');
--29
SELECT COD_S FROM SPJ
  WHERE COD_P='p1' AND CANTIDAD>(SELECT AVG(CANTIDAD) FROM SPJ
                                    WHERE COD_P='p1');
--30
SELECT DISTINCT CIUDAD FROM P UNION
SELECT DISTINCT CIUDAD FROM J UNION
SELECT DISTINCT CIUDAD FROM S
ORDER BY CIUDAD; 
--31
ALTER TABLE P
MODIFY COLOR VARCHAR(7);
UPDATE P
SET COLOR='naranja'
  WHERE COLOR='rojo';
--32
DELETE FROM J
WHERE COD_J NOT IN(SELECT COD_J FROM SPJ)
  OR COD_J IN(SELECT COD_J FROM SPJ
                WHERE NVL(CANTIDAD,0)=0);
--33
DELETE FROM SPJ
WHERE COD_J IN(SELECT COD_J FROM J
  WHERE CIUDAD='Roma');
DELETE FROM J
  WHERE CIUDAD='Roma';
--34
ALTER TABLE S
MODIFY CIUDAD VARCHAR2(20);
ALTER TABLE S
MODIFY COD_S VARCHAR2(3);
ALTER TABLE SPJ
MODIFY COD_S VARCHAR2(3);
INSERT INTO S 
VALUES ('s10','White',NULL,'New York');